first_5_text = lead(first_5_text, 3),
first_6 = lead(first_6, 4),
first_6_text = lead(first_6_text, 5),
first_7 = lead(first_7, 6),
first_7_text = lead(first_7_text, 7)) %>%
rowwise() %>%
mutate(first_5 = ifelse(is.na(first_5), "-", first_5),
first_6 = ifelse(is.na(first_6), "-", first_6),
first_7 = ifelse(is.na(first_7), "-", first_7))
prep_data <-
select_data %>%
select(-last, -last_text) %>%
distinct() %>%
slice(1:200) %>%
mutate(id = lag(id),
first_3_text = lead(first_3_text),
first_5 = lead(first_5, 2),
first_5_text = lead(first_5_text, 3),
first_6 = lead(first_6, 4),
first_6_text = lead(first_6_text, 5),
first_7 = lead(first_7, 6),
first_7_text = lead(first_7_text, 7)) %>%
slice(5) %>%
mutate(first_5 = ifelse(is.na(first_5), "-", first_5),
first_6 = ifelse(is.na(first_6), "-", first_6),
first_7 = ifelse(is.na(first_7), "-", first_7))
View(prep_data)
prep_data <-
select_data %>%
select(-last, -last_text) %>%
distinct() %>%
slice(1:200) %>%
mutate(id = lag(id),
first_3_text = lead(first_3_text),
first_5 = lead(first_5, 2),
first_5_text = lead(first_5_text, 3),
first_6 = lead(first_6, 4),
first_6_text = lead(first_6_text, 5),
first_7 = lead(first_7, 6),
first_7_text = lead(first_7_text, 7)) %>%
mutate(first_5 = ifelse(is.na(first_5), "-", first_5),
first_6 = ifelse(is.na(first_6), "-", first_6),
first_7 = ifelse(is.na(first_7), "-", first_7))
prep_data <-
select_data %>%
select(-last, -last_text) %>%
distinct() %>%
slice(1:200) %>%
mutate(id = lag(id),
first_3_text = lead(first_3_text),
first_5 = lead(first_5, 2),
first_5_text = lead(first_5_text, 3),
first_6 = lead(first_6, 4),
first_6_text = lead(first_6_text, 5),
first_7 = lead(first_7, 6),
first_7_text = lead(first_7_text, 7)) %>%
mutate(first_5 = ifelse(is.na(first_5), "-", first_5),
first_6 = ifelse((is.na(first_6) & !is.na(first5)), "-", first_6),
first_7 = ifelse((is.na(first_7) & !is.na(first_6)), "-", first_7))
prep_data <-
select_data %>%
select(-last, -last_text) %>%
distinct() %>%
slice(1:200) %>%
mutate(id = lag(id),
first_3_text = lead(first_3_text),
first_5 = lead(first_5, 2),
first_5_text = lead(first_5_text, 3),
first_6 = lead(first_6, 4),
first_6_text = lead(first_6_text, 5),
first_7 = lead(first_7, 6),
first_7_text = lead(first_7_text, 7)) %>%
mutate(first_5 = ifelse(is.na(first_5), "-", first_5),
first_6 = ifelse((is.na(first_6) & !is.na(first_5)), "-", first_6),
first_7 = ifelse((is.na(first_7) & !is.na(first_6)), "-", first_7))
prep_data <-
select_data %>%
select(-last, -last_text) %>%
distinct() %>%
slice(1:200) %>%
mutate(id = lag(id),
first_3_text = lead(first_3_text),
first_5 = lead(first_5, 2),
first_5_text = lead(first_5_text, 3),
first_6 = lead(first_6, 4),
first_6_text = lead(first_6_text, 5),
first_7 = lead(first_7, 6),
first_7_text = lead(first_7_text, 7))
prep_data <-
select_data %>%
select(-last, -last_text) %>%
distinct() %>%
slice(1:200) %>%
mutate(id = lag(id),
first_3_text = lead(first_3_text),
first_5 = lead(first_5, 2),
first_5_text = lead(first_5_text, 3),
first_6 = lead(first_6, 4),
first_6_text = lead(first_6_text, 5),
first_7 = lead(first_7, 6),
first_7_text = lead(first_7_text, 7)) %>%
mutate(first_5 = ifelse(is.na(first_5), "-", first_5),
first_6 = ifelse((is.na(first_6) & !is.na(first_5)), "-", first_6),
first_7 = ifelse((is.na(first_7) & !is.na(first_6)), "-", first_7))
prep_data <-
select_data %>%
select(-last, -last_text) %>%
distinct() %>%
slice(1:200) %>%
mutate(id = lag(id),
first_3_text = lead(first_3_text),
first_5 = lead(first_5, 2),
first_5_text = lead(first_5_text, 3),
first_6 = lead(first_6, 4),
first_6_text = lead(first_6_text, 5),
first_7 = lead(first_7, 6),
first_7_text = lead(first_7_text, 7)) %>%
mutate(first_5 = ifelse((is.na(first_5 & !is.na(first_3))), "-", first_5),
first_6 = ifelse((is.na(first_6) & !is.na(first_5)), "-", first_6),
first_7 = ifelse((is.na(first_7) & !is.na(first_6)), "-", first_7))
mutate(first_5 = ifelse((is.na(first_5 & !is.na(first_3)), "-", first_5),
prep_data <-
select_data %>%
select(-last, -last_text) %>%
distinct() %>%
slice(1:200) %>%
mutate(id = lag(id),
first_3_text = lead(first_3_text),
first_5 = lead(first_5, 2),
first_5_text = lead(first_5_text, 3),
first_6 = lead(first_6, 4),
first_6_text = lead(first_6_text, 5),
first_7 = lead(first_7, 6),
first_7_text = lead(first_7_text, 7)) %>%
mutate(first_5 = ifelse((is.na(first_5) & !is.na(first_3)), "-", first_5),
first_6 = ifelse((is.na(first_6) & !is.na(first_5)), "-", first_6),
first_7 = ifelse((is.na(first_7) & !is.na(first_6)), "-", first_7))
prep_data <-
select_data %>%
select(-last, -last_text) %>%
distinct() %>%
slice(1:200) %>%
mutate(id = lag(id),
first_3_text = lead(first_3_text),
first_5 = lead(first_5, 2),
first_5_text = lead(first_5_text, 3),
first_6 = lead(first_6, 4),
first_6_text = lead(first_6_text, 5),
first_7 = lead(first_7, 6),
first_7_text = lead(first_7_text, 7)) %>%
mutate(first_5 = ifelse((is.na(first_5) & !is.na(first_3)), "-", first_5),
first_6 = ifelse((is.na(first_6) & !is.na(first_5)), "-", first_6),
first_7 = ifelse((is.na(first_7) & !is.na(first_6)), "-", first_7)) %>%
distinct()
prep_data <-
select_data %>%
select(-last, -last_text) %>%
distinct() %>%
slice(1:200) %>%
mutate(id = lag(id),
first_3_text = lead(first_3_text),
first_5 = lead(first_5, 2),
first_5_text = lead(first_5_text, 3),
first_6 = lead(first_6, 4),
first_6_text = lead(first_6_text, 5),
first_7 = lead(first_7, 6),
first_7_text = lead(first_7_text, 7)) %>%
mutate(first_5 = ifelse((is.na(first_5) & !is.na(first_3)), "-", first_5),
first_6 = ifelse((is.na(first_6) & !is.na(first_5)), "-", first_6),
first_7 = ifelse((is.na(first_7) & !is.na(first_6)), "-", first_7)) %>%
mutate(first_5_text = ifelse(first_5 == "-", "-", first_5_text)) %>%
distinct()
prep_data <-
select_data %>%
select(-last, -last_text) %>%
distinct() %>%
slice(1:200) %>%
mutate(id = lag(id),
first_3_text = lead(first_3_text),
first_5 = lead(first_5, 2),
first_5_text = lead(first_5_text, 3),
first_6 = lead(first_6, 4),
first_6_text = lead(first_6_text, 5),
first_7 = lead(first_7, 6),
first_7_text = lead(first_7_text, 7)) %>%
mutate(first_5 = ifelse((is.na(first_5) & !is.na(first_3)), "-", first_5),
first_6 = ifelse((is.na(first_6) & !is.na(first_5)), "-", first_6),
first_7 = ifelse((is.na(first_7) & !is.na(first_6)), "-", first_7)) %>%
mutate(first_5_text = ifelse(first_5 == "-", "-", first_5_text),
first_6_text = ifelse(first_6 == "-", "-", first_6_text),
first_7_text = ifelse(first_7 == "-", "-", first_7_text)) %>%
distinct()
fill_data <-
prep_data %>%
fill(id, .direction = "down") %>%
fill(section, .direction = "down") %>%
fill(id, .direction = "down") %>%
fill(first_3, .direction = "down") %>%
fill(first_3_text, .direction = "down") %>%
fill(first_5, .direction = "down") %>%
fill(first_5_text, .direction = "down") %>%
fill(first_6, .direction = "down") %>%
fill(first_6_text, .direction = "down") %>%
fill(first_7, .direction = "down") %>%
fill(first_7_text, .direction = "down") %>%
filter(str_sub(first_7, 1, 3) == str_sub(first_3, 1, 3)) %>%
distinct() %>%
#filter(str_detect(id, "S40")) %>%
left_join(get_last)
fill_data <-
prep_data %>%
fill(id, .direction = "down") %>%
fill(section, .direction = "down") %>%
fill(id, .direction = "down") %>%
fill(first_3, .direction = "down") %>%
fill(first_3_text, .direction = "down") %>%
fill(first_5, .direction = "down") %>%
fill(first_5_text, .direction = "down") %>%
fill(first_6, .direction = "down") %>%
fill(first_6_text, .direction = "down") %>%
fill(first_7, .direction = "down") %>%
fill(first_7_text, .direction = "down")
fill_data <-
prep_data %>%
fill(id, .direction = "down") %>%
fill(section, .direction = "down") %>%
fill(id, .direction = "down") %>%
fill(first_3, .direction = "down") %>%
fill(first_3_text, .direction = "down") %>%
fill(first_5, .direction = "down") %>%
fill(first_5_text, .direction = "down") %>%
fill(first_6, .direction = "down") %>%
fill(first_6_text, .direction = "down") %>%
fill(first_7, .direction = "down") %>%
fill(first_7_text, .direction = "down") %>%
distinct()
fill_data <-
prep_data %>%
fill(id, .direction = "down") %>%
fill(section, .direction = "down") %>%
fill(id, .direction = "down") %>%
fill(first_3, .direction = "down") %>%
fill(first_3_text, .direction = "down") %>%
fill(first_5, .direction = "down") %>%
fill(first_5_text, .direction = "down") %>%
fill(first_6, .direction = "down") %>%
fill(first_6_text, .direction = "down") %>%
fill(first_7, .direction = "down") %>%
fill(first_7_text, .direction = "down") %>%
distinct() %>%
filter(!is.na(id)) %>%
#filter(str_detect(id, "S40")) %>%
left_join(get_last)
fill_data <-
prep_data %>%
fill(region, .direction = "down") %>%
fill(section, .direction = "down") %>%
fill(region, .direction = "down") %>%
fill(first_3, .direction = "down") %>%
fill(first_3_text, .direction = "down") %>%
fill(first_5, .direction = "down") %>%
fill(first_5_text, .direction = "down") %>%
fill(first_6, .direction = "down") %>%
fill(first_6_text, .direction = "down") %>%
fill(first_7, .direction = "down") %>%
fill(first_7_text, .direction = "down") %>%
distinct() %>%
filter(!is.na(region)) %>%
#filter(str_detect(id, "S40")) %>%
left_join(get_last)
get_sections <-
get_data %>%
distinct(region_text = sectionRef, first, last, region = id)
select_data <-
get_data %>%
select(region = id6,
section = name,
first_3 = name8,
first_3_text = desc9,
first_5 = name10,
first_5_text = desc11,
first_6 = name14,
first_6_text = desc15,
first_7 = name20,
first_7_text = desc21,
last = char,
last_text = extension) %>%
distinct()
get_last <-
select_data %>%
distinct(region, last, last_text) %>%
filter(complete.cases(.))
prep_data <-
select_data %>%
select(-last, -last_text) %>%
distinct() %>%
slice(1:200) %>%
mutate(region = lag(region),
first_3_text = lead(first_3_text),
first_5 = lead(first_5, 2),
first_5_text = lead(first_5_text, 3),
first_6 = lead(first_6, 4),
first_6_text = lead(first_6_text, 5),
first_7 = lead(first_7, 6),
first_7_text = lead(first_7_text, 7)) %>%
mutate(first_5 = ifelse((is.na(first_5) & !is.na(first_3)), "-", first_5),
first_6 = ifelse((is.na(first_6) & !is.na(first_5)), "-", first_6),
first_7 = ifelse((is.na(first_7) & !is.na(first_6)), "-", first_7)) %>%
mutate(first_5_text = ifelse(first_5 == "-", "-", first_5_text),
first_6_text = ifelse(first_6 == "-", "-", first_6_text),
first_7_text = ifelse(first_7 == "-", "-", first_7_text)) %>%
distinct()
fill_data <-
prep_data %>%
fill(region, .direction = "down") %>%
fill(section, .direction = "down") %>%
fill(region, .direction = "down") %>%
fill(first_3, .direction = "down") %>%
fill(first_3_text, .direction = "down") %>%
fill(first_5, .direction = "down") %>%
fill(first_5_text, .direction = "down") %>%
fill(first_6, .direction = "down") %>%
fill(first_6_text, .direction = "down") %>%
fill(first_7, .direction = "down") %>%
fill(first_7_text, .direction = "down") %>%
distinct() %>%
filter(!is.na(region)) %>%
#filter(str_detect(id, "S40")) %>%
left_join(get_last)
get_regions <-
get_data %>%
distinct(region_text = sectionRef, first, last, region = id)
fill_data <-
prep_data %>%
fill(region, .direction = "down") %>%
fill(section, .direction = "down") %>%
fill(region, .direction = "down") %>%
fill(first_3, .direction = "down") %>%
fill(first_3_text, .direction = "down") %>%
fill(first_5, .direction = "down") %>%
fill(first_5_text, .direction = "down") %>%
fill(first_6, .direction = "down") %>%
fill(first_6_text, .direction = "down") %>%
fill(first_7, .direction = "down") %>%
fill(first_7_text, .direction = "down") %>%
distinct() %>%
filter(!is.na(region)) %>%
#filter(str_detect(id, "S40")) %>%
left_join(get_last) %>%
left_join(get_regions)
View(get_data)
rm(get_sections)
select_data <-
get_data %>%
select(region = id6,
section = name,
first_3 = name8,
first_3_text = desc9,
first_5 = name10,
first_5_text = desc11,
first_6 = name14,
first_6_text = desc15,
first_7 = name20,
first_7_text = desc21,
last = char,
last_text = extension) %>%
distinct()
get_last <-
select_data %>%
distinct(region, last, last_text) %>%
filter(complete.cases(.))
prep_data <-
select_data %>%
select(-last, -last_text) %>%
distinct() %>%
slice(1:200) %>%
mutate(region = lag(region),
first_3_text = lead(first_3_text),
first_5 = lead(first_5, 2),
first_5_text = lead(first_5_text, 3),
first_6 = lead(first_6, 4),
first_6_text = lead(first_6_text, 5),
first_7 = lead(first_7, 6),
first_7_text = lead(first_7_text, 7)) %>%
mutate(first_5 = ifelse((is.na(first_5) & !is.na(first_3)), "-", first_5),
first_6 = ifelse((is.na(first_6) & !is.na(first_5)), "-", first_6),
first_7 = ifelse((is.na(first_7) & !is.na(first_6)), "-", first_7)) %>%
mutate(first_5_text = ifelse(first_5 == "-", "-", first_5_text),
first_6_text = ifelse(first_6 == "-", "-", first_6_text),
first_7_text = ifelse(first_7 == "-", "-", first_7_text)) %>%
distinct()
fill_data <-
prep_data %>%
fill(region, .direction = "down") %>%
fill(section, .direction = "down") %>%
fill(region, .direction = "down") %>%
fill(first_3, .direction = "down") %>%
fill(first_3_text, .direction = "down") %>%
fill(first_5, .direction = "down") %>%
fill(first_5_text, .direction = "down") %>%
fill(first_6, .direction = "down") %>%
fill(first_6_text, .direction = "down") %>%
fill(first_7, .direction = "down") %>%
fill(first_7_text, .direction = "down") %>%
distinct() %>%
filter(!is.na(region)) %>%
#filter(str_detect(id, "S40")) %>%
left_join(get_last) %>%
left_join(get_regions)
prep_data <-
select_data %>%
select(-last, -last_text) %>%
distinct() %>%
#slice(1:200) %>%
mutate(region = lag(region),
first_3_text = lead(first_3_text),
first_5 = lead(first_5, 2),
first_5_text = lead(first_5_text, 3),
first_6 = lead(first_6, 4),
first_6_text = lead(first_6_text, 5),
first_7 = lead(first_7, 6),
first_7_text = lead(first_7_text, 7)) %>%
mutate(first_5 = ifelse((is.na(first_5) & !is.na(first_3)), "-", first_5),
first_6 = ifelse((is.na(first_6) & !is.na(first_5)), "-", first_6),
first_7 = ifelse((is.na(first_7) & !is.na(first_6)), "-", first_7)) %>%
mutate(first_5_text = ifelse(first_5 == "-", "-", first_5_text),
first_6_text = ifelse(first_6 == "-", "-", first_6_text),
first_7_text = ifelse(first_7 == "-", "-", first_7_text)) %>%
distinct()
fill_data <-
prep_data %>%
fill(region, .direction = "down") %>%
fill(section, .direction = "down") %>%
fill(region, .direction = "down") %>%
fill(first_3, .direction = "down") %>%
fill(first_3_text, .direction = "down") %>%
fill(first_5, .direction = "down") %>%
fill(first_5_text, .direction = "down") %>%
fill(first_6, .direction = "down") %>%
fill(first_6_text, .direction = "down") %>%
fill(first_7, .direction = "down") %>%
fill(first_7_text, .direction = "down") %>%
distinct() %>%
filter(!is.na(region)) %>%
#filter(str_detect(id, "S40")) %>%
left_join(get_last) %>%
left_join(get_regions)
fill_data <-
prep_data %>%
fill(region, .direction = "down") %>%
fill(section, .direction = "down") %>%
fill(region, .direction = "down") %>%
fill(first_3, .direction = "down") %>%
fill(first_3_text, .direction = "down") %>%
fill(first_5, .direction = "down") %>%
fill(first_5_text, .direction = "down") %>%
fill(first_6, .direction = "down") %>%
fill(first_6_text, .direction = "down") %>%
fill(first_7, .direction = "down") %>%
fill(first_7_text, .direction = "down") %>%
distinct() %>%
filter(!is.na(region)) %>%
#filter(str_detect(id, "S40")) %>%
left_join(get_last) %>%
left_join(get_regions %>% select(contains("region"))) %>%
select(section,
contains("region"))
fill_data <-
prep_data %>%
fill(region, .direction = "down") %>%
fill(section, .direction = "down") %>%
fill(region, .direction = "down") %>%
fill(first_3, .direction = "down") %>%
fill(first_3_text, .direction = "down") %>%
fill(first_5, .direction = "down") %>%
fill(first_5_text, .direction = "down") %>%
fill(first_6, .direction = "down") %>%
fill(first_6_text, .direction = "down") %>%
fill(first_7, .direction = "down") %>%
fill(first_7_text, .direction = "down") %>%
distinct() %>%
filter(!is.na(region)) %>%
#filter(str_detect(id, "S40")) %>%
left_join(get_last) %>%
left_join(get_regions %>% select(contains("region"))) %>%
select(section,
contains("region"), everything())
count(fill_data, section, region)
fill_data <-
prep_data %>%
fill(region, .direction = "down") %>%
fill(section, .direction = "down") %>%
fill(region, .direction = "down") %>%
fill(first_3, .direction = "down") %>%
fill(first_3_text, .direction = "down") %>%
fill(first_5, .direction = "down") %>%
fill(first_5_text, .direction = "down") %>%
fill(first_6, .direction = "down") %>%
fill(first_6_text, .direction = "down") %>%
fill(first_7, .direction = "down") %>%
fill(first_7_text, .direction = "down") %>%
distinct() %>%
filter(!is.na(region)) %>%
#filter(str_detect(id, "S40")) %>%
left_join(get_last) %>%
left_join(get_regions %>% select(contains("region"))) %>%
mutate(last = ifelse(is.na(last), "-", last),
last_text = ifelse(is.na(last_text), "-", last_text)) %>%
select(section,
contains("region"),
everything())
View(fill_data)
